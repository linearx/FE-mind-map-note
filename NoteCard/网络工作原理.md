## 计算机网络原理

> https://www.bilibili.com/video/BV1xJ41137Q3

概述、网络应用、传输层、网络层、数据链路层和局域网、物理层、无线与移动网络、网络安全基础

---

> 网络工作分为若干个层次，每个层次实现一个功能。如应用层、基于http的www，还有电子邮件等均属于应用层。

> 应用层的数据相当于邮件；传输层功能相当于邮局；网络层相当于选取何路径运输、如高速公路、邮轮等；数据链路层相当于快递小哥，局域网是当地邮局；

---

以**TCP/IP体系结构**为核心，自顶向下的组织方式；领会计算机网络的**分层设计**和各层间的关系；需要知道各层次要解决的问题。

> 不同体系的功能；某一体系不同层的功能。

---

### 1.计算机网络概述

---

##### 计算机网络

  计算机网络是**互连**的、**自治**的计算机的集合。

---

##### 协议

  不同设备交换数据需要遵循的规定，包含三个要素：**语法、语义、时序**

语法：格式（邮封的填写规则，如邮编）

语义：按格式写入数据后，数据的实际含义（邮编代表的含义）

时序：交换信息的顺序，如何匹配、适应速度（写信应收到回信的规则）

---

##### 功能

​	硬件、软件、信息共享

---

##### 分类

​	覆盖范围：个域网、局域网、城域网、广域网

​	拓扑结构：星型、总线型、环形、网状、树形、混合

​	交换方式（**数据通信的手段**）：电路交换（固定电话）、报文交换（电报）、**分组交换**

> *报文*(message)是网络中交换与传输的数据单元，即站点一次性要发送的数据块。*报文*包含了将要发送的完整的数据信息，其长短很不一致，长度不限且可变。

---

##### 计算机网络结构

  网络边缘：需要接入网络的设备

  接入网络：电话拨号、**非对称用户数字线ADSL**、**混合光纤同轴电缆HFC**、局域网、移动接入、WiFi

  网络核心：进行通讯交换的结点的集合  

---

##### 数据交换技术

  各设备直接互联的网状结构->各设备通过交换结点相连的局域网->各交换节点再相连，组成通信子网，也即网络核心

  1.电路交换：中间交换结点为两台主机之间建立专用的通信线路，用该电路通信结束后拆除电路（电话拨号）

  2.报文交换：无需建立连接，以报文为单位在交换网络各节点进行存储-转发。

  3.**分组交换**：将一个完整报文拆分为若干个分组，分组传输也采用存储-转发（比如页面中视频的传输），无需等待整个报文接收完，交换设备存储容量要求低。*分组长度的确定要考虑分组长度、延迟时间以及误码率*

---

##### 计算机网络性能

1. 速率/带宽：单位时间内船速的数据量，单位为bit/s，或bps 

2. 时延/延迟：数据从一个结点到另一个结点所需要的时间，产生原因有：结点处理时延、排队时延、传输时延（数据到传送带用时）、**传播时延（数据在传送带上传输用时）**

>   eg.10Mbps的网络接口发送完50Mbytes的分组数据大致用时  5 s
>
> （注：10Mbps对应10/8 = 1.25Mb/s，因为Mbps中为bit，对应的是位，Mb的b对应的是byte，对应的字节，每个字节有8位。）

3. 时延带宽积：传播时延和链路带宽的乘机，对应一段链路中可以荣安的数据位数。

4. 丢包率：丢失分组总数/发送分组总数，可以反映网络拥塞程度。结点能够存储的数据有限，假如过于堵塞，新来的数据无法存储便将丢失。

5. 吞吐量：单位时间内源主机通过网络向目的主机实际送达的数据量

---

##### 计算机网络体系结构

1. 分层思想：网络完成的功能分为若干层，每层完成一部分子功能；**层在完成相应功能时与另一通信实体的相同层，按照某种协议进行信息交换。**
2. 体系结构：计算机网络**划分的层次**，以及**各层协议的集合**。

  （应用层-传输层-网络层-网络链路层-物理层）

---

  OSI参考模型（开放系统参考互联）

<img src="D:\Pictures\Markdown_pics\image-20211225151401542.png" alt="image-20211225151401542" style="zoom:67%;" />

发送方由顶至底封装，最后以byte流形式在物理层传输，接收方接受byte流后自底向顶解封

---

  **TCP/IP参考模型** 四层结构，其应用层包含了OSI的会话、表示、应用层。

<img src="D:\Pictures\Markdown_pics\image-20211225151539392.png" alt="image-20211225151539392" style="zoom:67%;" />

---

### 2. 计算机网络**应用**体系结构

##### 计算机网络**应用**体系结构

三种类型：

C/S，即客户/服务器结构：通信只在客户与服务器之间进行、客户与客户之间不进行通信。

P2P结构（peer to peer），也即对等结构，每个对等端均可以请求服务，也可以为提供服务，对等端之间直接通信。

混合结构，上述两种结构的混合，既有服务器，又有对等端。

##### 网络应用通信的基本原理

网络通信实际上都是一方发送请求，另一方回应请求。发送请求为客户端，回应请求为服务端。

C/S通信结构下，服务器端运行的为服务器进程，被动等待客户请求服务；客户端运行客户进程，可以主动发起通信，请求服务器进程提供服务。**应用程序间遵循应用层协议（API）交换应用层报文**

> 注意应用处于应用层，因此应用程序间的通信交流，发送端需要通过层层封装，最终再从物理层发送，而接收端需要层层解封，最后才能在应用层端获取到对应信息。

> eg.【单选题】以下关于客户/服务器模式比较的描述中，错误的是( )。
> A.在一次进程通信中发起通信的一方叫作客户端，接收连接请求的一方叫作服务器端**√**
> B.从工作模式角度，Internet应用系统分为两类:客户/服务器模式与对等模式**√**
> C.客户/服务器反映出这样一种网络服务提供者与网络服务使用者的关系**√**
> D.所有程序在进程通信中的客户端与服务器端的地位是不变的
>
> **P2P模式下，客户端与服务器端两者地位可能发生改变。但在一次进**
>
> **程通信过程中，两者是区分开的**

##### 域名系统DNS

采用特定字符、以特定结构来表示计算机名称的命名方法，使用层次树状结构。（**由于IP地址为数字，人难以记忆，使用域名与ip关联**）

![image-20211225183559713](D:\Pictures\Markdown_pics\image-20211225183559713.png)

1. 域名解析：将域名映射为IP地址
2. 域名服务器：用于转化域名的服务器，需要建立分布式数据库用以存储网络中域名与IP地址的映射关系；**域名服务器根据用户的请求提供域名解析服务。**。
3. 域名服务器分类：根域名、顶级域名、权威域名、本地域名服务器

> eg.【单选题】以下关于根域名服务器的描述中，错误的是(**C**)。
>
> A.目前存在13个DNS根域名服务器**√**
>
> B.a.root-server.net是一台DNS根域名服务器的域名**√**
>
> C.根域名服务器都是由位于同一个地理位置的服务器集群组成**×**
>
> **【解析】大多数根域名服务器都是由独立的多台物理服务器构成的服务器集群，而有的根域名服务器则是由分布在不同地理位置的多台镜像服务器组成的。**
>
> D. DNS根域名服务器对于DNS系统的整体运行具有极为重要的作用**√**

4. 域名解析过程

   域名解析本质上就是从域名服务器的数据库中获取域名对应的ip地址，但所请求的域名服务器本地不一定有相应的记录。 

   （1）递归查询，域名服务器代替客户端进一步向下一级域名服务器查询。**但网络中的查询服务很多，若使用递归查询则域名服务器工作量将十分大。**

   （2）迭代查询，域名服务器若查不到域名，会将下一步需要查询的服务器告诉查询主机。

##### 万维网应用

1. 应用结构：Web服务器；浏览器；超文本**（网页文件，HTML语言编写）**传输协议（HTTP）

   工作过程：（**点击一个超链接发生了什么？**）

   （1）首先根据网页超链接中的域名通过DNS查询获取到Web服务器的ip地址，建立TCP连接（传输层，作用为保证传输的可靠性，从而保证应用层的www的正常工作）；

   （2）使用HTTP协议将URL（统一资源定位器，也即网址）封装为HTTP报文，发送到Web服务器。

   （3）服务器根据URL找到相应的网页资源，随后将用HTML编写的页面以HTTP报文的响应信息返回给客户机。

   （4）客户机的浏览器将得到的HTML页面解读，以特定形式呈现。

   ![image-20211225233747237](D:\Pictures\Markdown_pics\image-20211225233747237.png)

   ---

2. HTTP

超文本传输协议，定义了**浏览器**如何向**Web服务器**发送请求，以及Web服务器如何向浏览器进行响应

版本：HTTP/1.0和HTTP/1.1，对应非持久连接和持久连接。

（1）持久与非持久连接

![image-20211225234726297](D:\Pictures\Markdown_pics\image-20211225234726297.png)

（HTML上的很多资源，比如图片，并非直接包含在该页面上，而是会给出一个相应的URL，此时需要重新向Web服务器请求。假如使用非持久连接，在解析HTML的时候遇到这种情况需要不断的向Web建立TCP连接，发送新的请求，获取新的文件；

若使用并行连接，会根据所需要建立连接的次数，同时建立多个TCP连接。（串行与并行的区别）

若使用持久连接，则是建立一次TCP连接后，请求完所有需求后再结束连接。持久连接包含非流水和流水两种方式，非流水是请求-获取-请求-获取；流水为同时发送多个请求。）

---

（2）HTTP报文

**请求报文：客户->服务器**

![image-20211225235750508](D:\Pictures\Markdown_pics\image-20211225235750508.png)

HTTP典型的请求方法有GET、HEAD、POST、OPTION、PUT等。
（1）GET：请求读取由URL所标识的信息。

（2）HEAD:请求读取由URL所标识的信息的首部无尔在响应报文中包含对象。

（3）POST:给服务器添加信息（例如，注释)。

（4）OPTION :请求一些选项的信息。

（5）PUT:在指明的URL下存储一个文档。

**响应报文：服务器->客户**

HTTP版本       404/502等状态码    描述状态码的短语

![image-20211226000338178](D:\Pictures\Markdown_pics\image-20211226000338178.png)

状态码分类：

1xx：信息提示
	通告信息，可能还需要进一步交互
2xx：成功
	成功完成客户请求的操作，并进行响应
3xx：重定向
	表示资源已移走，需要向新URL发请求
4xx：客户端错误
	由于客户端请求错误，无法成功响应
5xx：服务器端错误

​	由于服务器端错误，无法成功响应

---

> eg. 采用非持久连接访问包含100张图片的HTML页面，需要至少建立 **101** 次TCP连接
>
> （**页面+100个图片文件，共101个对象**）
>
> 非持久连接每次请求数据都需要建立TCP连接，即便使用并行连接也只是同时建立了101个TCP。

---

（3）Cookie

希望根据用户以前是否访问过网站以及历史行为，提供个性化服务（**比如免登录**）。但HTTP协议为无状态性，因此互联网使用Cookie记录，从而来弥补这一点。

Cookie为**小型文本文件**，指某些网站为了辨别用户身份、进行会话跟踪而存储于用户本地终端的数据。服务器端则存储该用户对应的Cookie ID

![image-20211226001324441](D:\Pictures\Markdown_pics\image-20211226001324441.png)

##### 电子邮件 略

端口25

![image-20211226002334080](D:\Pictures\Markdown_pics\image-20211226002334080.png)

##### FTP

文件传送协议，再互联网的两个主机间实现文件互传的应用层协议。

采用双端口连接的形式，控制命令与数据命令分开。优势在于可以在数据传输过程中发送中断命令。

![image-20211226110142172](D:\Pictures\Markdown_pics\image-20211226110142172.png)

##### P2P

充分聚集利用了端系统（对等方主机）的计算能力和网络传输带宽，对服务器的依赖较小（**即让用户配合，闲时提供其带宽服务**）

##### **Socket编程**

在应用层之间存在接口Socket，便于应用层区调用底层的服务。UDP成本低、效率快但不保证数据传输的可靠性、TCP则在传输数据前需要进行连接，可靠、但占用资源，效率相对较低。

![image-20211226143450267](D:\Pictures\Markdown_pics\image-20211226143450267.png)

---

Socket编程需要区分服务端和客户端。

1. TCP

  服务端需要提供特定监听端口，并进行绑定**(bind)**。随后要进行监听**(linsten)**，等待客户端请求。当有客户请求时，首先建立TCP连接**(accept)**，随后接收客户端的命令**(recv)**，并反馈对应的数据**(send)**。

![image-20211226143741683](D:\Pictures\Markdown_pics\image-20211226143741683.png)

2. UDP

  无需建立连接，在特定端口接收到相应命令后便进行反馈。

![image-20211226144226153](D:\Pictures\Markdown_pics\image-20211226144226153.png)

---

### 3. 传输层

**传输层主要为应用层提供传输服务。**

##### 传输层的**基本服务**

传输层的核心任务是为**应用进程之间提供端到端（每个端就是一个应用程序）的逻辑通信服务**。
主要功能包括:

（1）传输层寻址：与主机ip地址不同，而还需要知道数据要传输到哪个应用程序

（2）应用层报文的分段和重组：数据过大的时候需要分段发送，接收到分组数据后要按顺序重组

（3）报文的差错检测：检测所发送数据是否损坏

（4）进程间的端到端可靠数据传输控制：如何确认数据传输到正确的应用程序

（5）面向应用层实现复用与分解：

（6）端到端的流量控制：避免传输速度过快，导致接收方应用尚未处理完数据又受到下一批数据。

（7）拥塞控制。发送方应能及时发现网络拥堵。

> 传输层协议提供**逻辑通信服务**;
>
> 传输层协议只需**在端系统中实现**;
>
> 通信的**真正端点**并不是主机，而是主机中运行的**应用进程**。
>
> **传输层负责应用到应用的通信；网络层负责主机到主机的通信**

---

传输层寻址——寻找应用程序的方法

使用**端口号**进行应用进程的标识。

全网范围内“**IP地址+端口号**”可以唯一标识一个通信的端点**（某一台主机的某一个应用进程）**

> 端口号为16位整数，包含三类
>
> 0-1023：熟知端口，固定分配给某些程序的，如80端口为HTTP
>
> 1024-49151：登记端口，同样只固定分配给一些程序，使用这个范围的端口号需在IANA等级。
>
> 49152-65535：客户端端口或短暂端口，为客户端进程暂时使用
>
> eg.以下**TCP熟知端口号**错误的为（**D**）
>
> A. POP3：110（邮局协议，用于收邮件）
>
> B. SMTP：25 （简单邮件传输协议，用于发邮件）
>
> C. HTTP：90（Web服务程序）
>
> D. DNS：53 （域名服务）
>
> DNS端口号为53，但其采用的为**UDP协议**而非TCP协议，从而提高效率

关于UDP与TCP的区别，如下。首先需要握手，才能传输信息，握手的过程保证的连接的可靠性。

![image-20211226154343198](D:\Pictures\Markdown_pics\image-20211226154343198.png)

> TCP协议三次握手、四次挥手
>
> https://network.51cto.com/art/202001/609110.htm

##### 传输层的复用与分解

传输层需要为**不同的应用**提供服务，因此要能够实现复用和分解，也即**多路复用与多路分解**，是传输层的一项基本功能，支持多个应用进程共同用一个传输层协议。

---

1. UDP套接字：<目的IP地址，目的端口号>

   使用UDP套接字中的端口号即可实现UDP的多路复用和多路分解。

2. TCP套接字：<源IP地址、源端口号、目的IP地址、目的端口号>

   当TCP报文到达主机时，主机会根据这4个值将报文段分解到对应的套接字

> **UDP使用套接字的端口号进行区分；TCP使用整个套接字进行区分**

##### 停—等协议与滑动窗口协议

> **TCP协议中如何保证通信的可靠性**；由于传输层的数据传输还依赖于网络层，为此需要有相应措施去保证在网络层的传输不会出错。

保证数据传输可靠的措施：

1.差错检测:利用**差错编码**实现数据包传输过程中的比特差错检测。

2.确认:接收方向发送方反馈接收状态。

3.重传:发送方重新发送接收方没有正确接收的数据

4.序号:确保数据按序提交。（**避免重传过程收到两份数据导致的错误，因为报文通常是分组的**）

5.计时:解决数据丢失问题。（**规定时间没有接收到则认为其已丢失**）

---

**1.停-等协议**

> **停-等协议的主要特点就是每发送一个报文段后就停下来等待接收方的确认。**

停-等协议的**基本工作过程**:
1.发送方发送经过差错编码和编号的报文段，等待接收方的确认;**(发送并等待确认)**
2接收方如果正确接收报文段，即差错检测无误且序号正确，则接收报文段，并向发送方发送ACK，否则丢弃报文段，并向发送方发送NAK;**(接收并确认/否认)**
3.发送方如果收到ACK，则继续发送后续报文段，否则重发刚刚发送的报文段。**(继续发送/重发)**、

---

**2.滑动窗口协议**-典型流水线协议

> 但停等协议会面临性能问题，其机制会降低信道的利用率。因此可以通过**流水线协议**，即允许发送方在没有收到确认的情况下便发送多个分组，
>
> 关于流水线协议，为方便其正常工作，应当增加分组序号的范围（**原先的报文本就以分组形式传输，此时要传输多个分组，需要增加分组序号的范围**），同时两方必须缓存多个分组（**用以应对中间某个序号对应分组传输错误的问题，需要确认传输无误后方可删除**）。

![image-20211227003807252](D:\Pictures\Markdown_pics\image-20211227003807252.png)

发送方的数据在发送窗口进行缓存，但只有当队头的分组确认接收后，滑动窗口才能向前滑动；接收方同样也有一个滑动窗口。（**滑动窗口即工作区，数据在工作区中缓存。在其前面为处理完的数据，其后为未处理数据，也很符合流水线的说法**）

---

**两种最具有代表性的滑动窗口协议:**
1.向退N步(Go-Back-N，GBN）协议:
发送端窗口大小较大，可以在未得到确认前连续发送多个分组但**接收窗口大小仅为1**。**只能接收1个按序到达**的分组，未按序到达的分组或者某个分组差错，就会引起发送方重发该分组及其之后的所有分组。

（**分组不按序则直接重发**）

2.选择重传(Selective Repeat，SR）协议:
增加接收方缓存能力**（接收窗口>1)**，缓存正确到达但失序的分组，**仅要求发送方重传未被接收方确认的分组**，等缺失分组到达后一并向上层按序提交。

（**丢失的分组才需重传，乱序也可正确 组装**）

> eg.【单选题】从滑动窗口的观点来看，**停等协议**的窗口小为( **A** )。
> A.发送窗口=1，接收窗口=1
>
> B.发送窗口>1，接收窗口=1
>
> C.发送窗口=1，接收窗口>1
>
> D.发送窗口>1，接收窗口>1
>
> 【解析】停等协议发送端每发送一个报文就需要停下来等待对方确认，相当于发送窗口大小为1;接收端仅接文符合当前预期的一个报文，接收窗口大小为1。
>
> **停等协议也是滑动窗口协议的一种，其发送窗口=1，接收窗口=1；**

##### UDP-用户数据报协议

传输层无连接服务协议。结构如下

![image-20211227005003244](D:\Pictures\Markdown_pics\image-20211227005003244.png)

##### **TCP-传输控制协议**

https://network.51cto.com/art/202001/609110.htm

1.TCP报文结构

![image-20211227011052536](D:\Pictures\Markdown_pics\image-20211227011052536.png)

> 其中比较重要的字段有：
>
> - 序号(sequence number)：Seq 序号，占 32 位，用来标识从 TCP 源端向目的端发送的字节流，发起方发送数据时对此进行标记。
> - 确认号(acknowledgement number)：Ack 序号，占 32 位，只有 ACK 标志位为 1 时，确认序号字段才有效，Ack=Seq+1。
> - 标志位(Flags)：共 6 个，即 URG、ACK、PSH、RST、SYN、FIN 等。
>
> 六个标志位具体含义如下：
>
> - URG：紧急指针(urgent pointer)有效。
> - ACK：确认序号有效。
> - PSH：接收方应该尽快将这个报文交给应用层。
> - RST：重置连接。
> - SYN：发起一个新连接。
> - FIN：释放一个连接。

**2. 三次握手-TCP建立连接过程**

SYN连接请求(客户端发起同步请求)->SYNACK确认（服务器接收到请求，可进行同步）->ACK确认（客户端可接收到反馈，开始同步）

（注意seq为序号，ack为确认号，需与标志号进行区分）

![image-20211227010515419](D:\Pictures\Markdown_pics\image-20211227010515419.png)

**3.四次挥手-TCP断开连接过程**

FIN（客户端请求释放连接）->ACK（服务器接收到客户端发送的释放连接的请求（半关闭状态，仍可进行数据传输））->ACKFIN （服务器端已经准备好释放连接了）->ACK （客户端接收到服务器准备好释放连接的信号）

![image-20211227011754438](D:\Pictures\Markdown_pics\image-20211227011754438.png)

> 结束连接需要多一次，是由于服务器端接收到断开请求时不能立刻结束连接，而是需要等到数据完全传输结束后才可结束连接。

4.可靠数据传输

![image-20211227012738960](D:\Pictures\Markdown_pics\image-20211227012738960.png)

---

5.流量控制-利用窗口机制实现

![image-20211227013138148](D:\Pictures\Markdown_pics\image-20211227013138148.png)

---

6.拥塞控制

![image-20211227013304824](D:\Pictures\Markdown_pics\image-20211227013304824.png)

---

### 4. **网络层**

###### 网络层服务

将网络层数据报从**源主机送达到目的主机**（传输层为保证数据传输的可靠性，面向**应用**之间）

路由器存在多个输入端口，路由器需要能告诉这些数据需要从哪个输出端口走才能到目的地，选择的依据为查询转发表（基于路由表形成）。

![image-20211228152812435](D:\Pictures\Markdown_pics\image-20211228152812435.png)

主要功能有：

分组转发-将数据分组从输入接口转移到输出接口/

路由选择-决定分组数据要经过的路由或路径。

##### **数据报网络**与虚电路网络（**无连接与有连接**）

1.数据报网络:按照目的主机地址进行路由选择的网络。

（1）**无连接**;（2）**每个分组**作为一个独立的数据报进行传送，**路径也可能不同**->（3）分组可能出现**乱序和丢失**。(**不可靠，但效率高，成本低，是目前的主要网络方式**)

> 由于网络层采用无连接的数据报网络，因此需要有传输层使用TCP的方式来提供连接，从而确保数据传输的可靠性；但也有的网络可以提供连接。

2.虚电路网络：在网络层提供面向连接的分组交换服务。
（1）.建立一条网络层逻辑连接;（2）.不需要为每条虚电路分配独亨资源(区别于电路交换）;（3）.根据虚电路号沿虚电路路径按序发送分组。

##### 网络互连及设备（路由器）

1.异构网络：两个网络的**通信技术**和**运行协议**不同

实现的基本策略有：（1）协议转换（**中间存在翻译**）（2）构建虚拟互联网络（**转化为统一的协议（IP协议）**）

2.路由器—实现异构网络互联的关键，使用**交换结构**，在网络层上实现不同网络的互连和传输。

![image-20211228205803462](D:\Pictures\Markdown_pics\image-20211228205803462.png)

##### 网络层拥塞控制

1. 拥塞

用户对于网络资源的需求超过了网络固有容量，原因有：（1）缓冲区容量有限（2）传输线路的带宽有限（3）网络结点的处理能力有限（4）网络中某些部分发生了故障。

---

2. 拥塞控制——流量感知路由（**分流**）；准入控制（**审核**，用于虚电路）

根据网络负载动态调整)将网络流量引导到不同的链路上，均衡网络负载，从而延缓或避免拥塞发生。
解决网络负载的震荡现象:（1）多路径路由（2）缓慢（**避免另一条路也拥堵**）转移流量至另一链路。

##### **Internet网络层**（IP协议——IPv4协议、IPv6协议。）

1.IPv4协议

**首部固定20字节**

![image-20211228211123129](D:\Pictures\Markdown_pics\image-20211228211123129.png)

 版本：区分IPv4和IPv6

首部长度：用于判断可变部分有多长

区分服务：对不同服务提供不同服务质量

总长度：IP包的总长度

**IP数据报分片**

**标识：识别哪一个IP包**；判断分片是否属于同一个IP数据报

**标志：判断IP数据报是否被分割**；判断是否为最后一个分片

**片偏移：若被分割，在原先处于何位置**；判断分片的先后顺序

生存时间：若在网络上转发很多次仍未到目的地，当生存时间过长时便抛弃。

协议： 标识数据部分属于哪个协议（传输层UDP和TCP）的数据，以便相应处理

首部校验和：检验首部是否出错

源地址：发送方的主机IP地址（IPv4 32位）

目的地址：接收数据的主机IP地址

---

2.IPv4编址：32位二进制，每八位一组转化为十进制进行标记。

![image-20211228212339789](D:\Pictures\Markdown_pics\image-20211228212339789.png)

> IPv4总共43亿（255^4），可用的公网IP约有36.74亿个，怎么保证其数量够呢？
>
> https://www.zhihu.com/question/20168985
>
> 私有IP是为不至于每个PC手机都占有一个公网IP专门预留的、可以被每个家庭企业重复使用的、不可以被路由出去的地址。事实上全国人民有多少办公电脑和个人手机的IP地址都集中在192.168.1.0网段的254个IP地址上。**这些内网IP可以上网是采用了一种叫做NAT的技术，**也正是这种技术大大延缓了IPV4的耗尽速度。
>
> 有许多小微型企业安装的是**没有固定IP的宽带，家用宽带都不是固定IP的，公网IP是从运营商动态获取**的，估计相当于2个宽带共用1个公网IP地址吧。中国的家用宽带不知道有没有4亿户，大概需要2亿个公网IP。大中型企业有许多开通专线和公网IP的宽带、比如百度阿里这样的企业每个需要1000个公网IP、上市公司每个需要50个、中型企业需要10个，还有各个运营商的服务器、路由器也需要，全国加起来3亿个应该是足够的
>
> ---
>
> **但实际上还是不够用，因此使用了IPv6.**
>
> 作者：牧歌
> 链接：https://www.zhihu.com/question/20168985/answer/81185570
> 来源：知乎
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

将IP地址分为5类，为ABCDE五类，区分方式可看前几位

ABC三类地址分为网络号(net-id)与主机号(host-id)，同一个网络里的所有主机均具有相同的网络号。 

![image-20211228221710789](D:\Pictures\Markdown_pics\image-20211228221710789.png)

---

由于有的IP地址，如A类，其下管理的IP地址过多，因此需要将其划分为若干子网进行管理。通过将具有相同前缀的IP地址归类即可。（）

**子网划分**: 将一个较大的子网划分为多个较小子网的过程。较大子网具有较短的**网络前缀**,较小子网具有稍长的前缀。
**超网**: 将具有较长前缀的相对较小的子网合并为一个具有稍短前缀的相对较大的子网。
**子网掩码**: 用来定义一个子网的网络前缀长度。

> eg. 【综合题】假设某子网中的一个主机的IP地址是203.123.1.135，子网掩码是255.255.255.192，那么该子网的子网地址是什么?直接广播地址是什么?该子网IP地址总数是多少?该子网的可子配IP地址数是多少?可分配IP地址范围是多少?如何将该网络戈分为两个等大小的子网?
>
> 答案：子网地址为203.123.1.128/23(将IP地址与子网掩码进行与运算即为子网地址 IP^Mask = Subnet);
>
> **注：23为子网掩码中1的位数，也是前缀的长度**
>
> ![image-20211228231650184](D:\Pictures\Markdown_pics\image-20211228231650184.png)
>
> 直接广播地址为203.123.1.191(**范围内最大的地址**)，子网的IP地址总数为64个，除去子网地址（**范围内最小**）和直接广播地址，可分配的IP地址数为62个。
>
> ![image-20211228231916330](D:\Pictures\Markdown_pics\image-20211228231916330.png)
>
> **将子网掩码延长一位后，将子网地址和广播地址进行与运算**，则子网将被划分为2个子网。![image-20211228234112156](D:\Pictures\Markdown_pics\image-20211228234112156.png)

---

xiang

当一个IP地址进入路由器时，为了将其转发到相应出口，需要查找转发表，将其与转发表内各网络地址**对应掩码进行与运算**，找到与其符合的网络地址后，参照其下一跳地址和接口进行转发。

但若与每一项都进行匹配，需要耗费很多时间，因此可以通过路由聚合的方式，将相同路由的连续子网合并

![image-20211228235328396](D:\Pictures\Markdown_pics\image-20211228235328396.png)

> ![image-20211228235818434](D:\Pictures\Markdown_pics\image-20211228235818434.png)
>
> **最长前缀匹配**，需要选取路由表中能匹配的最长前缀的网络地址作为路由
>
> ![image-20211229000309143](D:\Pictures\Markdown_pics\image-20211229000309143.png)
>
> （11位掩码和目的IP与完后不应该是132.0.0.0吗？19是0001 0011 相应掩码是 1110 0000，与完后是0，不匹配？）
>
> **需要将目的IP地址和网络地址都与掩码进行与运算后进行对比。**

---

3. 动态主机配置协议-DHCP，对网络内的主机提供**动态的IP地址分配服务**（主机数量过多，用此方法可减小工作量），在网络配置中的自动获得IP地址即使用DHCP协议。

---

4. 网络地址转换-NAT，IP地址不够用，使用NAT可以使用私有地址访问互联网。

   从内网进入互联网的IP数据报︰
   将其源IP地址替换为NAT服务器拥有的合法的**公共IP地址**，同时替换源端口号，并将替换关系**记录到NAT转换表**中;

   从互联网返回的IP数据报:
   依据其目的IP地址与目的端口号**检索NAT转换表**，**得到内部有IP地址与端口号**，替换目的IP地址和目的端口号，然后将数据报转发到内部网络

---

5。 **IPv6**-用于解决IPv4地址耗尽的问题

---



###### **路由算法与路由协议**

（路由：找到合适的路径进行转发；路由算法：如何找到合适的路径）

1.**链路状态**路由选择算法；路由器从其他路由器获取链路状态，从而建立处**整个网络的拓扑图**，计算最短路径使用Dijkstra算法。

![image-20211229232026622](D:\Pictures\Markdown_pics\image-20211229232026622.png)

计算从x出发，到各个节点的最短路径。首先以x为节点建立集合，找到与x最为接近的节点y。再以x,y为集合，找到其他节点到达x的距离，或途径y到x的最短路径节点……。

> 每轮都找到某一节点到初始节点的最短路径，其要么与初始节点直接相连，要么途径上一轮结点集合的路径到达初始节点。用这个办法，只要能够得到网络的拓扑图，就可以找到**所有节点到某一节点的最短路径**

---

2. 距离向量路由选择算法，只需要获取相邻路由器的路由信息即可，无需获取全局链路信息。（**使用的是递归思路，节点多时计算速度较慢**）

![image-20211229233134827](D:\Pictures\Markdown_pics\image-20211229233134827.png)

![image-20211229233830629](D:\Pictures\Markdown_pics\image-20211229233830629.png)

---

3. 层次化路由选择-不同的自治系统可以采用不同的路由协议、算法；再将不同的自治系统进行路由。

![image-20211229233944398](D:\Pictures\Markdown_pics\image-20211229233944398.png)

---

4. Internet路由选择协议：RIP-基于距离向量（最大距离不可超过15跳，即不能超过15个路由器）、OSPF-基于链路状态（内部网关）；BGP（外部网关，自治系统之间的网关协议）

---

### 5.数据链路层与局域网-作了解即可。

> 传输层实现了对应用层服务的复用、分用以及可靠传输；网络层负责经过路由转发将数据从主机到主机传输。

**数据链路层的作用是将数据可靠地从一个节点传到另一个节点。** 

##### 数据链路层服务

链路：相邻结点的通信通道。

工作过程：将网络层的数据加上帧头、帧尾后发送。

功能：组帧；链路接入——点对点；广播；可靠交付；差错控制

![image-20211230155106832](D:\Pictures\Markdown_pics\image-20211230155106832.png)



##### 差错控制（避免差错）

四种方式：

1. 检错重发：根据差错编码，发现接受数据有误，则让发送结点重新发送数据。
2. 前向纠错：无需重新发送，接收方知道数据哪里出错直接进行纠正
3. 反馈校验：接收方将数据原封不动地发给发送方，用以让发送方判断自己发送的数据是否有误
4. 检错丢弃：若数据有误，则接收方直接丢弃。高层长时间按未接收到数据通知发送方重发。

---

差错编码基本原理

香农信道编码定理：理论上可以通过编码使得数据传输过程中不发生错误，或将错误概率控制在很小的数值。

**双方的数据均经过相同的编码处理后进行**

![image-20211230160601189](D:\Pictures\Markdown_pics\image-20211230160601189.png)

---

汉明距离-两个等长码字之间对应位的不同位数。**（决定差错编码的检错和纠错能力）**

![image-20211230160821903](D:\Pictures\Markdown_pics\image-20211230160821903.png)

---

典型的差错编码：奇偶校验（无法纠错）；汉明码；循环冗余码**CRC**（广泛使用）。

![image-20211230171347661](D:\Pictures\Markdown_pics\image-20211230171347661.png)

> eg![image-20211230171615162](D:\Pictures\Markdown_pics\image-20211230171615162.png)
>
> 其CRC编码为：101110011001 计算过程如下：（1*x^4 + 0 *x^3 + 0 *x^2 + 1 * x + 1 * x^0）
>
> ![image-20211230175055003](D:\Pictures\Markdown_pics\image-20211230175055003.png)

##### 多路访问控制协议（广播链路）

1.多路访问控制MAC，用于在广播信道上用于协调各个结点的数据发送（点对点的链路无需协调）

信道划分MAC协议：（不同的信道划分方法）

（1）**频分**多路复用:在频域内将信道带宽划分为多个子信道

（2）**时分**多路复用:将通信信道的传输信号在时域内划分为多个等长的时隙。
（3）**波分**多路复用:在一根光纤中，传输多路不同波长的光信号

（4）**码分**多路复用:从编码域进行划分，使得编码后的信号在一信道中混合传输。

2.**随机**访问MAC协议-ALOHA协议/CSMA协议

3.受控接入MAC协议，由一个管理站主机进行轮询调度，从而避免冲突。

##### 局域网-广播链路

网络层—IP地址，数据链路层—MAC地址（物理地址）；

每个接口对应一个MAC地址，长度48位且全球唯一。

**地址解析协议**：根据目的主机的IP地址获取其MAC地址，使用查询/相应的方式。

---

**以太网技术**

IEEE802.3标准规定的网络，采用CSMA/CD访问控制方法

---

**交换机**：通过链路层帧中的目的MAC地址，选择性地转发到相应的端口。

##### 点对点链路协议-PPP、HDLC

典型应用——拨号上网

---

### 6 物理层-将数据转化为比特进行传输

通信相关，略

关键词：数据通信基础、物理介质、信道与信道容量、基带传输、频带传输、物理层接口规范。

---

通信：在一点精确或近似地再生另一点的信息

数据：对客观事物的性质状态以及相互关系等进行记载的符号及其组合

信道：信号通道

---

导引传输介质：架空明线；双绞线；同轴光缆；光纤。

非导引储阿生农户戒指：地波、天波、视线传播

---

![image-20211230224706332](D:\Pictures\Markdown_pics\image-20211230224706332.png)

> eg.![image-20211230225131923](D:\Pictures\Markdown_pics\image-20211230225131923.png)
>

---

### 8.网络安全基础

##### 网络安全概述

网络安全基本概念：什么样的网络是安全的？

**机密性、消息完整性、可访问与可用性、身份认证**（确保对方身份的真实性）都可以保证的网络，才是安全的网络。

---

网络安全威胁：

窃听（物理层电路传输的电磁辐射变化）、插入、假冒（过去邮件姓名mail from可能被假冒）、劫持（发送的信息被截获后篡改）、DoS拒绝服务和DDoS分布式拒绝服务、映射（对各端口进行扫描，若有响应可以判断得到其相应的服务，再通过这个服务的漏洞入侵）、嗅探、IP欺骗（将数据报的IP地址替换）

##### 数据加密

基本概念：

明文：未被加密的信息；密文：被加密的信息

加密：明文转变为密文；解密：密文转变为明文

---

加密方式：

1.传统加密方式

替代密码（密文字母代替明文字母）、换位密码（按一定的规则重新排列明文）

2.对称密钥加密-加密密钥与解密密钥相同（**密钥需要保密**），如分组密钥DES、AES、IDEA

**非对称密钥**-加密密钥与解密密钥不同，一个公钥一个私钥。如Diffie-Hellman算法、RSA算法。

![image-20211231231902100](D:\Pictures\Markdown_pics\image-20211231231902100.png)

##### 消息完整性与数字签名

**消息完整性**（保证信息未被第三方篡改，或者篡改后能够即时检测出来）的检测方法：密码散列函数

典型散列函数：**MD5**，SHA-1

---

数字签名：

用于身份认证、数据完整性、不可否认性（也是一个加密过程，使用私钥进行加密，用于证明消息为自己发出的，同时具有不可否认性，你签过名就代表是你实际认可过的，如银行的U盾中就含有私钥）

##### 身份认证

口令-会被窃听；加密口令-会被回放攻击；加密一次性随机数（会受到中间人攻击）（这三种均不算安全。）

##### 密钥（保证加密的安全性）分发中心和证书认证

密钥分发中心KDC

双方通信时需要协商一个新的密钥，因此需要由密钥中心为双方分发密钥；分为两种方式，一种为通信发起方生成密钥，KDC进行分发，另一种为KDC直接生成并分发密钥

---

证书认证中心CA-将公钥与特定的实体进行绑定

![image-20220101015851218](D:\Pictures\Markdown_pics\image-20220101015851218.png)

##### 防火墙与入侵检测系统

 ![image-20220101020211968](D:\Pictures\Markdown_pics\image-20220101020211968.png)

![image-20220101020300821](D:\Pictures\Markdown_pics\image-20220101020300821.png)

---

三、入侵检测系统IDS

假如已经有人入侵，防火墙也无法起作用。因此可以使用IDS进行流量监控，当观察到潜在的恶意流量时，可以产生警告。

##### 网络安全协议

1.安全电子邮件标准——PGP

2.安全套接字（TCP）层——SSL（**应用层与传输层之间的安全协议，在TCP之上建立**）

![image-20220101020804150](D:\Pictures\Markdown_pics\image-20220101020804150.png)

3.虚拟专用网-VPN（在公共网络上建立的专用网络通道）

![image-20220101020909757](D:\Pictures\Markdown_pics\image-20220101020909757.png)

4.网络层（IP）安全协议——IPSec